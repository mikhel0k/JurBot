<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шаг 2: введите данные вашей организации</title>
    <link rel="stylesheet" href="styles1.css">
</head>
<body>
    <main class="page page--wide">
        <section class="form-container">
            <header class="form-header">
                <a class="back-link" href="register-step1.html" aria-label="Назад">
                    <img src="images/Vector.svg" alt="" class="back-icon">
                </a>
                <h1 class="form-header-title">Шаг 2: введите данные вашей организации</h1>
            </header>

            <form class="form form--two-cols" id="company-form">
                <div class="form-group">
                    <label class="label" for="name">Название</label>
                    <input
                        class="input"
                        type="text"
                        id="name"
                        name="name"
                        placeholder="Название вашей организации"
                        required
                    >
                </div>
                <div class="form-group">
                    <label class="label" for="address">Адрес</label>
                    <input
                        class="input"
                        type="text"
                        id="address"
                        name="address"
                        placeholder="Адрес регистрации организации"
                        required
                    >
                </div>
                <div class="form-group">
                    <label class="label" for="inn">ИНН</label>
                    <input
                        class="input"
                        type="text"
                        id="inn"
                        name="inn"
                        placeholder="7707083893"
                        required
                    >
                </div>
                <div class="form-group">
                    <label class="label" for="snils">СНИЛС</label>
                    <input
                        class="input"
                        type="text"
                        id="snils"
                        name="snils"
                        placeholder="12345678901"
                        required
                    >
                </div>
                <div class="form-group">
                    <label class="label" for="bank">Банковские реквезиты</label>
                    <input
                        class="input"
                        type="text"
                        id="bank"
                        name="bank"
                        placeholder="БИК, расчётный счёт и т.п."
                    >
                </div>
                <div class="form-group">
                    <label class="label" for="ogrn">ОГРН</label>
                    <input
                        class="input"
                        type="text"
                        id="ogrn"
                        name="ogrn"
                        placeholder="3746382946573"
                    >
                </div>
                <div class="form-group">
                    <label class="label" for="activity">Вид деятельности</label>
                    <input
                        class="input"
                        type="text"
                        id="activity"
                        name="activity"
                        placeholder="Разработка программного обеспечения"
                    >
                </div>

                <div class="buttons-row">
                    <a href="#" class="button button--secondary">Пропустить</a>
                    <button class="button" type="submit">Продолжить</button>
                </div>
                <p class="form-hint" id="company-message" aria-live="polite"></p>
            </form>
        </section>
    </main>

    <script>
        (function () {
            const form = document.getElementById('company-form');
            const messageEl = document.getElementById('company-message');

            if (!form) {
                return;
            }

            form.addEventListener('submit', async (event) => {
                event.preventDefault();
                messageEl.textContent = '';

                const formData = new FormData(form);
                const payload = {
                    name: (formData.get('name') || '').toString().trim(),
                    inn: (formData.get('inn') || '').toString().trim(),
                    snils: (formData.get('snils') || '').toString().trim(),
                    address: (formData.get('address') || '').toString().trim(),
                    bank: (formData.get('bank') || '').toString().trim(),
                    ogrn: (formData.get('ogrn') || '').toString().trim(),
                    activity: (formData.get('activity') || '').toString().trim(),
                };

                if (!payload.name || !payload.inn || !payload.snils || !payload.address) {
                    messageEl.textContent = 'Заполните обязательные поля: название, адрес, ИНН, СНИЛС.';
                    return;
                }

                try {
                    const response = await fetch('http://localhost:8000/v1/company/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify(payload),
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        messageEl.textContent = errorData.detail || 'Ошибка при сохранении компании.';
                        return;
                    }

                    messageEl.textContent = 'Данные компании отправлены на сервер.';
                    // После успешного создания компании можно перейти на главную страницу
                    // window.location.href = 'main.html';
                } catch (error) {
                    console.error(error);
                    messageEl.textContent = 'Не удалось связаться с сервером.';
                }
            });
        })();
    </script>
</body>
</html>
